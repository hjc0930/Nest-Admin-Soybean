# ğŸ‰ GitHub Actions è‡ªåŠ¨åŒ–éƒ¨ç½²é…ç½®æ€»ç»“

## âœ… å·²å®Œæˆçš„é…ç½®

### 1. GitHub Actions å·¥ä½œæµæ–‡ä»¶

å·²åˆ›å»ºä¸¤ä¸ªè‡ªåŠ¨åŒ–éƒ¨ç½²å·¥ä½œæµï¼š

- **`.github/workflows/deploy.yml`**
  - ç®€å•éƒ¨ç½²å·¥ä½œæµ
  - é€‚åˆå°å‹é¡¹ç›®æˆ–ç®€å•éƒ¨ç½²éœ€æ±‚
  
- **`.github/workflows/deploy-advanced.yml`** â­ æ¨è
  - é«˜çº§éƒ¨ç½²å·¥ä½œæµï¼ŒåŒ…å«ï¼š
    - âœ… è‡ªåŠ¨å¤‡ä»½
    - âœ… å‹ç¼©ä¼ è¾“
    - âœ… å¥åº·æ£€æŸ¥
    - âœ… è‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½
    - âœ… è¯¦ç»†æ—¥å¿—

### 2. é…ç½®æ–‡æ¡£

- **`docs/GITHUB_ACTIONS.md`** - å®Œæ•´çš„é…ç½®æŒ‡å—
- **`docs/QUICK_START_DEPLOY.md`** - å¿«é€Ÿå¼€å§‹æŒ‡å—
- **`DEPLOYMENT_README.md`** - éƒ¨ç½²æ¦‚è§ˆ

### 3. è¾…åŠ©è„šæœ¬

- **`scripts/check-deploy-config.sh`** - Linux/Mac é…ç½®æ£€æŸ¥è„šæœ¬
- **`scripts/check-deploy-config.bat`** - Windows é…ç½®æ£€æŸ¥è„šæœ¬

### 4. PM2 é…ç½®

é¡¹ç›®å·²åŒ…å« `server/ecosystem.config.cjs` PM2 é…ç½®æ–‡ä»¶

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### ç¬¬ 1 æ­¥ï¼šç”Ÿæˆ SSH å¯†é’¥ï¼ˆ2 åˆ†é’Ÿï¼‰

```bash
# ç”Ÿæˆå¯†é’¥å¯¹
ssh-keygen -t rsa -b 4096 -C "github-actions" -f ~/.ssh/github-actions -N ""

# å°†å…¬é’¥æ·»åŠ åˆ°æœåŠ¡å™¨
ssh-copy-id -i ~/.ssh/github-actions.pub user@your-server-ip

# æŸ¥çœ‹ç§é’¥ï¼ˆå¤åˆ¶æ­¤å†…å®¹åˆ° GitHub Secretsï¼‰
cat ~/.ssh/github-actions
```

### ç¬¬ 2 æ­¥ï¼šé…ç½® GitHub Secretsï¼ˆ3 åˆ†é’Ÿï¼‰

1. æ‰“å¼€ä»“åº“: https://github.com/linlingqin77/Nest-Admin
2. è¿›å…¥ `Settings` â†’ `Secrets and variables` â†’ `Actions`
3. ç‚¹å‡» `New repository secret` æ·»åŠ ä»¥ä¸‹ 6 ä¸ª secretsï¼š

| Secret åç§° | å€¼ | ç¤ºä¾‹ |
|------------|-----|------|
| `SSH_PRIVATE_KEY` | ç²˜è´´ç§é’¥å®Œæ•´å†…å®¹ | `-----BEGIN RSA PRIVATE KEY-----...` |
| `REMOTE_HOST` | æœåŠ¡å™¨ IP | `123.456.78.90` |
| `REMOTE_USER` | SSH ç”¨æˆ·å | `root` æˆ– `www` |
| `REMOTE_PORT` | SSH ç«¯å£ | `22` |
| `REMOTE_BACKEND_DIR` | åç«¯ç›®å½• | `/www/wwwroot/nest-admin-server` |
| `REMOTE_FRONTEND_DIR` | å‰ç«¯ç›®å½• | `/www/wwwroot/nest-admin-frontend` |

### ç¬¬ 3 æ­¥ï¼šæœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡ï¼ˆ5 åˆ†é’Ÿï¼‰

SSH ç™»å½•åˆ°æœåŠ¡å™¨ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# 1. å®‰è£… Node.js 20.xï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# 2. å®‰è£… pnpm å’Œ PM2
npm install -g pnpm pm2

# 3. åˆ›å»ºéƒ¨ç½²ç›®å½•
sudo mkdir -p /www/wwwroot/nest-admin-server
sudo mkdir -p /www/wwwroot/nest-admin-frontend
sudo mkdir -p /www/wwwlogs/pm2/nest_admin_server

# 4. è®¾ç½®ç›®å½•æƒé™
sudo chown -R $USER:$USER /www/wwwroot
sudo chown -R $USER:$USER /www/wwwlogs

# 5. é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
cd /www/wwwroot/nest-admin-server
nano .env.production
```

åœ¨ `.env.production` æ–‡ä»¶ä¸­å¡«å…¥ï¼š

```env
NODE_ENV=production
PORT=3000

# æ•°æ®åº“é…ç½®
DATABASE_URL="postgresql://user:password@localhost:5432/nest_admin"

# Redis é…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password
REDIS_DB=2

# JWT é…ç½®
JWT_SECRET=your_production_jwt_secret_key

# å…¶ä»–é…ç½®æ ¹æ®é¡¹ç›®éœ€è¦æ·»åŠ ...
```

```bash
# 6. è®¾ç½® PM2 å¼€æœºè‡ªå¯
pm2 startup
# æŒ‰ç…§æç¤ºæ‰§è¡Œè¿”å›çš„å‘½ä»¤
pm2 save
```

### ç¬¬ 4 æ­¥ï¼šæµ‹è¯•éƒ¨ç½²ï¼ˆ1 åˆ†é’Ÿï¼‰

æäº¤å¹¶æ¨é€ä»£ç ï¼š

```bash
git add .
git commit -m "chore: configure github actions deployment"
git push origin main-soybean
```

ç„¶åè®¿é—®ï¼š
- GitHub: https://github.com/linlingqin77/Nest-Admin/actions
- æŸ¥çœ‹éƒ¨ç½²è¿›åº¦å’Œæ—¥å¿—

## ğŸ”§ é…ç½®æ£€æŸ¥å·¥å…·

è¿è¡Œé…ç½®æ£€æŸ¥è„šæœ¬ï¼š

```bash
# Linux/Mac
bash scripts/check-deploy-config.sh

# Windows
scripts\check-deploy-config.bat
```

## ğŸ“Š å·¥ä½œæµè§¦å‘æ¡ä»¶

### è‡ªåŠ¨è§¦å‘
- æ¨é€ä»£ç åˆ° `main` æˆ– `main-soybean` åˆ†æ”¯æ—¶è‡ªåŠ¨éƒ¨ç½²

### æ‰‹åŠ¨è§¦å‘
1. è®¿é—® GitHub Actions é¡µé¢
2. é€‰æ‹©å·¥ä½œæµ
3. ç‚¹å‡» "Run workflow"
4. é€‰æ‹©åˆ†æ”¯å¹¶è¿è¡Œ

## ğŸ” ç›‘æ§å’Œç®¡ç†

### æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
- GitHub: https://github.com/linlingqin77/Nest-Admin/actions

### æœåŠ¡å™¨ç®¡ç†
```bash
# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
pm2 list

# æŸ¥çœ‹æ—¥å¿—
pm2 logs nest_admin_server

# é‡å¯åº”ç”¨
pm2 restart nest_admin_server

# æŸ¥çœ‹å®æ—¶ç›‘æ§
pm2 monit
```

## ğŸ“š è¯¦ç»†æ–‡æ¡£

éœ€è¦æ›´å¤šä¿¡æ¯ï¼ŸæŸ¥çœ‹ä»¥ä¸‹æ–‡æ¡£ï¼š

1. **[docs/GITHUB_ACTIONS.md](docs/GITHUB_ACTIONS.md)**
   - å®Œæ•´çš„é…ç½®æŒ‡å—
   - æ•…éšœæ’æŸ¥
   - æœ€ä½³å®è·µ

2. **[docs/QUICK_START_DEPLOY.md](docs/QUICK_START_DEPLOY.md)**
   - å¿«é€Ÿå¼€å§‹æŒ‡å—

3. **[DEPLOYMENT_README.md](DEPLOYMENT_README.md)**
   - éƒ¨ç½²æ¦‚è§ˆ

## ğŸ¯ éƒ¨ç½²æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨é€ä»£ç åˆ° Git  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GitHub Actions     â”‚
â”‚  æ£€æµ‹åˆ°ä»£ç å˜æ›´      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ„å»ºå‰ç«¯           â”‚
â”‚  (admin-naive-ui)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ„å»ºåç«¯           â”‚
â”‚  (server)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‹ç¼©æ„å»ºäº§ç‰©       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸Šä¼ åˆ°æœåŠ¡å™¨       â”‚
â”‚  (SSH + SCP)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤‡ä»½å½“å‰ç‰ˆæœ¬       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§£å‹å¹¶å®‰è£…ä¾èµ–     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PM2 é‡å¯åº”ç”¨       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¥åº·æ£€æŸ¥           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  éƒ¨ç½²å®Œæˆ âœ…        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš¡ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### GitHub Secrets é…ç½®æ¸…å•
```bash
# éœ€è¦é…ç½®çš„ 6 ä¸ª Secretsï¼š
âœ“ SSH_PRIVATE_KEY      # SSH ç§é’¥
âœ“ REMOTE_HOST          # æœåŠ¡å™¨ IP
âœ“ REMOTE_USER          # SSH ç”¨æˆ·å
âœ“ REMOTE_PORT          # SSH ç«¯å£
âœ“ REMOTE_BACKEND_DIR   # åç«¯ç›®å½•
âœ“ REMOTE_FRONTEND_DIR  # å‰ç«¯ç›®å½•
```

### æœåŠ¡å™¨å¸¸ç”¨å‘½ä»¤
```bash
# PM2 ç®¡ç†
pm2 list                        # æŸ¥çœ‹åº”ç”¨åˆ—è¡¨
pm2 logs nest_admin_server      # æŸ¥çœ‹æ—¥å¿—
pm2 restart nest_admin_server   # é‡å¯åº”ç”¨
pm2 stop nest_admin_server      # åœæ­¢åº”ç”¨
pm2 monit                       # ç›‘æ§é¢æ¿

# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
tail -f /www/wwwlogs/pm2/nest_admin_server/out.log
tail -f /www/wwwlogs/pm2/nest_admin_server/err.log

# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :3000
netstat -tlnp | grep 3000
```

## ğŸ†˜ é‡åˆ°é—®é¢˜ï¼Ÿ

### å¸¸è§é—®é¢˜
1. **SSH è¿æ¥å¤±è´¥** â†’ æ£€æŸ¥ç§é’¥æ ¼å¼å’ŒæœåŠ¡å™¨é…ç½®
2. **æ„å»ºå¤±è´¥** â†’ æŸ¥çœ‹ GitHub Actions æ—¥å¿—
3. **PM2 å¯åŠ¨å¤±è´¥** â†’ æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿— `pm2 logs`
4. **ç«¯å£å ç”¨** â†’ æ£€æŸ¥ç«¯å£å¹¶æ€æ­»å ç”¨è¿›ç¨‹

### è·å–å¸®åŠ©
- æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£
- æ£€æŸ¥ GitHub Actions æ—¥å¿—
- æ£€æŸ¥æœåŠ¡å™¨ PM2 æ—¥å¿—
- æäº¤ Issue

## âœ¨ ç‰¹æ€§äº®ç‚¹

- âœ… é›¶åœæœºéƒ¨ç½²
- âœ… è‡ªåŠ¨å¤‡ä»½ä¸å›æ»š
- âœ… å¥åº·æ£€æŸ¥
- âœ… è¯¦ç»†æ—¥å¿—è®°å½•
- âœ… æ”¯æŒæ‰‹åŠ¨è§¦å‘
- âœ… å¤šç¯å¢ƒæ”¯æŒ
- âœ… PM2 è¿›ç¨‹ç®¡ç†
- âœ… å‹ç¼©ä¼ è¾“ä¼˜åŒ–

## ğŸ“ˆ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. é…ç½® Nginx åå‘ä»£ç†
2. å¯ç”¨ HTTPS (Let's Encrypt)
3. é…ç½® CDN åŠ é€Ÿé™æ€èµ„æº
4. è®¾ç½®ç›‘æ§å‘Šè­¦
5. é…ç½®æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½
6. å¯ç”¨æ—¥å¿—åˆ‡å‰²

---

**ç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼** ğŸš€

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£æˆ–æäº¤ Issueã€‚
